(*
 * ModelConfig.zpp - Model Configuration State and Invariants
 * Z++ Formal Specification for Deltecho Model Package
 * 
 * Defines the formal specification for model architecture configuration,
 * including transformer parameters, attention mechanisms, and cognitive
 * architecture integration.
 *)

SCHEMA ModelConfig
IMPORTS Types

(* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   SECTION 1: Architecture Type Definitions
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê *)

TYPE ArchitectureType ::=
    DeltechoTransformer |              (* Primary Deltecho architecture *)
    DeltechoMoE |                      (* Mixture of Experts variant *)
    DeltechoHybrid                     (* Hybrid attention variant *)

TYPE AttentionType ::=
    MultiHeadAttention |               (* Standard MHA *)
    GroupedQueryAttention |            (* GQA for efficiency *)
    MultiQueryAttention |              (* MQA single KV head *)
    SlidingWindowAttention |           (* Local attention window *)
    CognitiveStreamAttention           (* Cross-stream attention *)

TYPE PositionEmbeddingType ::=
    Absolute |                         (* Learned absolute positions *)
    RoPE |                             (* Rotary Position Embedding *)
    ALiBi |                            (* Attention with Linear Biases *)
    NoPE                               (* No position embedding *)

TYPE ActivationType ::=
    GELU |                             (* Gaussian Error Linear Unit *)
    SiLU |                             (* Sigmoid Linear Unit / Swish *)
    ReLU |                             (* Rectified Linear Unit *)
    QuickGELU                          (* Approximated GELU *)

TYPE NormalizationType ::=
    LayerNorm |                        (* Layer Normalization *)
    RMSNorm |                          (* Root Mean Square Norm *)
    GroupNorm                          (* Group Normalization *)

TYPE InitializationType ::=
    Xavier |                           (* Xavier/Glorot initialization *)
    Kaiming |                          (* He initialization *)
    Orthogonal |                       (* Orthogonal initialization *)
    Normal                             (* Normal distribution *)

(* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   SECTION 2: Attention Configuration
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê *)

TYPE AttentionConfig == ‚ü¶
    attention_type: AttentionType,
    num_attention_heads: NumHeads,
    num_key_value_heads: NumHeads,     (* For GQA/MQA *)
    head_dim: ‚Ñï‚ÇÅ,
    attention_dropout: Probability,
    attention_bias: ùîπ,
    
    (* Sliding window parameters *)
    sliding_window: optional ‚Ñï‚ÇÅ,
    
    (* RoPE parameters *)
    rope_theta: optional ‚Ñù,
    rope_scaling: optional ‚ü¶
        type: {Linear, Dynamic, YaRN},
        factor: ‚Ñù
    ‚üß,
    
    (* Cognitive stream attention *)
    cross_stream_attention: ùîπ,
    stream_attention_heads: optional ‚Ñï‚ÇÅ
‚üß

(* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   SECTION 3: Feed-Forward Configuration
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê *)

TYPE FFNConfig == ‚ü¶
    intermediate_size: ‚Ñï‚ÇÅ,
    activation_function: ActivationType,
    ffn_dropout: Probability,
    ffn_bias: ùîπ,
    
    (* MoE parameters *)
    is_moe: ùîπ,
    num_experts: optional ‚Ñï‚ÇÅ,
    num_experts_per_tok: optional ‚Ñï‚ÇÅ,
    expert_capacity: optional ‚Ñï‚ÇÅ
‚üß

(* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   SECTION 4: Cognitive Architecture Configuration
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê *)

TYPE CognitiveConfig == ‚ü¶
    (* Stream configuration *)
    num_streams: ‚Ñï‚ÇÅ,
    stream_hidden_dim: HiddenDim,
    stream_interleave_layers: seq ‚Ñï‚ÇÅ,
    
    (* Cognitive loop parameters *)
    cognitive_steps: ‚Ñï‚ÇÅ,
    phase_offset: ‚Ñï‚ÇÅ,
    
    (* Mode distribution *)
    expressive_steps: ‚Ñï‚ÇÅ,
    reflective_steps: ‚Ñï‚ÇÅ,
    
    (* Nested shell structure *)
    nest_levels: ‚Ñï‚ÇÅ,
    nest_terms: seq ‚Ñï‚ÇÅ,
    
    (* Memory integration *)
    memory_attention: ùîπ,
    memory_slots: optional ‚Ñï‚ÇÅ,
    memory_dim: optional HiddenDim
‚üß

(* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   SECTION 5: Model Configuration State
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê *)

STATE ModelConfigState == ‚ü¶
    (* Model identification *)
    model_type: seq‚ÇÅ CHAR,
    architectures: seq‚ÇÅ ArchitectureType,
    
    (* Core dimensions *)
    vocab_size: VocabSize,
    hidden_size: HiddenDim,
    num_hidden_layers: NumLayers,
    
    (* Attention configuration *)
    attention: AttentionConfig,
    
    (* Feed-forward configuration *)
    ffn: FFNConfig,
    
    (* Position embedding *)
    position_embedding_type: PositionEmbeddingType,
    max_position_embeddings: SeqLen,
    
    (* Normalization *)
    normalization_type: NormalizationType,
    layer_norm_eps: ‚Ñù,
    
    (* Embedding *)
    tie_word_embeddings: ùîπ,
    embedding_dropout: Probability,
    
    (* Initialization *)
    initializer_range: ‚Ñù,
    initialization_type: InitializationType,
    
    (* Cognitive architecture *)
    cognitive: CognitiveConfig,
    
    (* Training configuration *)
    use_cache: ùîπ,
    output_attentions: ùîπ,
    output_hidden_states: ùîπ,
    
    (* Precision *)
    torch_dtype: {float16, bfloat16, float32},
    
    (* Tokenizer reference *)
    bos_token_id: TokenId,
    eos_token_id: TokenId,
    pad_token_id: TokenId
‚üß

(* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   SECTION 6: Invariant Predicates
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê *)

PRED ValidAttentionConfig(a: AttentionConfig, h: HiddenDim) ‚âú
    (* Head dimension must divide hidden size *)
    h mod a.num_attention_heads = 0 ‚àß
    a.head_dim = h div a.num_attention_heads ‚àß
    
    (* KV heads must divide attention heads *)
    a.num_attention_heads mod a.num_key_value_heads = 0 ‚àß
    
    (* Sliding window constraints *)
    (a.sliding_window ‚â† ‚ä• ‚áí a.sliding_window! > 0) ‚àß
    
    (* RoPE constraints *)
    (a.rope_theta ‚â† ‚ä• ‚áí a.rope_theta! > 0) ‚àß
    
    (* Cross-stream attention requires stream heads *)
    (a.cross_stream_attention ‚áí a.stream_attention_heads ‚â† ‚ä•)

PRED ValidFFNConfig(f: FFNConfig, h: HiddenDim) ‚âú
    (* Intermediate size typically 4x hidden *)
    f.intermediate_size ‚â• h ‚àß
    
    (* MoE constraints *)
    (f.is_moe ‚áí 
        f.num_experts ‚â† ‚ä• ‚àß
        f.num_experts_per_tok ‚â† ‚ä• ‚àß
        f.num_experts! > 0 ‚àß
        f.num_experts_per_tok! > 0 ‚àß
        f.num_experts_per_tok! ‚â§ f.num_experts!)

PRED ValidCognitiveConfig(c: CognitiveConfig) ‚âú
    (* Must match cognitive architecture constants *)
    c.num_streams = COGNITIVE_STREAMS ‚àß
    c.cognitive_steps = COGNITIVE_STEPS ‚àß
    c.phase_offset = PHASE_OFFSET ‚àß
    
    (* Mode distribution must sum to total steps *)
    c.expressive_steps + c.reflective_steps = c.cognitive_steps ‚àß
    c.expressive_steps = EXPRESSIVE_STEPS ‚àß
    c.reflective_steps = REFLECTIVE_STEPS ‚àß
    
    (* Nested shell structure *)
    c.nest_levels = NEST_LEVELS ‚àß
    #c.nest_terms = c.nest_levels ‚àß
    c.nest_terms = NEST_TERMS ‚àß
    
    (* Stream hidden dim constraints *)
    ValidHiddenDim(c.stream_hidden_dim) ‚àß
    
    (* Memory constraints *)
    (c.memory_attention ‚áí 
        c.memory_slots ‚â† ‚ä• ‚àß 
        c.memory_dim ‚â† ‚ä• ‚àß
        c.memory_slots! > 0)

(* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   SECTION 7: State Invariants
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê *)

INVARIANT ModelConfigInvariant
    ‚àÄ config: ModelConfigState ‚Ä¢
        (* Core dimension constraints *)
        ValidVocabSize(config.vocab_size) ‚àß
        ValidHiddenDim(config.hidden_size) ‚àß
        MIN_NUM_LAYERS ‚â§ config.num_hidden_layers ‚â§ MAX_NUM_LAYERS ‚àß
        
        (* Attention validity *)
        ValidAttentionConfig(config.attention, config.hidden_size) ‚àß
        
        (* FFN validity *)
        ValidFFNConfig(config.ffn, config.hidden_size) ‚àß
        
        (* Cognitive architecture validity *)
        ValidCognitiveConfig(config.cognitive) ‚àß
        
        (* Position embedding constraints *)
        ValidSeqLen(config.max_position_embeddings) ‚àß
        
        (* Layer norm epsilon must be positive *)
        config.layer_norm_eps > 0 ‚àß
        
        (* Initializer range must be positive *)
        config.initializer_range > 0 ‚àß
        
        (* Token IDs must be valid *)
        config.bos_token_id < config.vocab_size ‚àß
        config.eos_token_id < config.vocab_size ‚àß
        config.pad_token_id < config.vocab_size

(* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   SECTION 8: Default Configuration
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê *)

CONST DEFAULT_MODEL_CONFIG: ModelConfigState = ‚ü¶
    model_type ‚Ü¶ "deltecho",
    architectures ‚Ü¶ ‚ü®DeltechoTransformer‚ü©,
    
    vocab_size ‚Ü¶ DEFAULT_VOCAB_SIZE,
    hidden_size ‚Ü¶ DEFAULT_HIDDEN_DIM,
    num_hidden_layers ‚Ü¶ DEFAULT_NUM_LAYERS,
    
    attention ‚Ü¶ ‚ü¶
        attention_type ‚Ü¶ GroupedQueryAttention,
        num_attention_heads ‚Ü¶ DEFAULT_NUM_HEADS,
        num_key_value_heads ‚Ü¶ 8,
        head_dim ‚Ü¶ DEFAULT_HIDDEN_DIM div DEFAULT_NUM_HEADS,
        attention_dropout ‚Ü¶ 0.0,
        attention_bias ‚Ü¶ false,
        sliding_window ‚Ü¶ ‚ä•,
        rope_theta ‚Ü¶ 10000.0,
        rope_scaling ‚Ü¶ ‚ä•,
        cross_stream_attention ‚Ü¶ true,
        stream_attention_heads ‚Ü¶ 4
    ‚üß,
    
    ffn ‚Ü¶ ‚ü¶
        intermediate_size ‚Ü¶ 14336,
        activation_function ‚Ü¶ SiLU,
        ffn_dropout ‚Ü¶ 0.0,
        ffn_bias ‚Ü¶ false,
        is_moe ‚Ü¶ false,
        num_experts ‚Ü¶ ‚ä•,
        num_experts_per_tok ‚Ü¶ ‚ä•,
        expert_capacity ‚Ü¶ ‚ä•
    ‚üß,
    
    position_embedding_type ‚Ü¶ RoPE,
    max_position_embeddings ‚Ü¶ DEFAULT_SEQ_LEN,
    
    normalization_type ‚Ü¶ RMSNorm,
    layer_norm_eps ‚Ü¶ 1e-5,
    
    tie_word_embeddings ‚Ü¶ false,
    embedding_dropout ‚Ü¶ 0.0,
    
    initializer_range ‚Ü¶ 0.02,
    initialization_type ‚Ü¶ Normal,
    
    cognitive ‚Ü¶ ‚ü¶
        num_streams ‚Ü¶ COGNITIVE_STREAMS,
        stream_hidden_dim ‚Ü¶ 1024,
        stream_interleave_layers ‚Ü¶ ‚ü®8, 16, 24‚ü©,
        cognitive_steps ‚Ü¶ COGNITIVE_STEPS,
        phase_offset ‚Ü¶ PHASE_OFFSET,
        expressive_steps ‚Ü¶ EXPRESSIVE_STEPS,
        reflective_steps ‚Ü¶ REFLECTIVE_STEPS,
        nest_levels ‚Ü¶ NEST_LEVELS,
        nest_terms ‚Ü¶ NEST_TERMS,
        memory_attention ‚Ü¶ true,
        memory_slots ‚Ü¶ 256,
        memory_dim ‚Ü¶ 1024
    ‚üß,
    
    use_cache ‚Ü¶ true,
    output_attentions ‚Ü¶ false,
    output_hidden_states ‚Ü¶ false,
    
    torch_dtype ‚Ü¶ bfloat16,
    
    bos_token_id ‚Ü¶ BOS_TOKEN_ID,
    eos_token_id ‚Ü¶ EOS_TOKEN_ID,
    pad_token_id ‚Ü¶ PAD_TOKEN_ID
‚üß

(* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   SECTION 9: Configuration Operations
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê *)

OP SetHiddenSize
    ŒîSTATE ModelConfigState
    new_hidden_size?: HiddenDim
    
    PRE ValidHiddenDim(new_hidden_size?) ‚àß
        new_hidden_size? mod attention.num_attention_heads = 0
    POST hidden_size' = new_hidden_size? ‚àß
         attention'.head_dim = new_hidden_size? div attention.num_attention_heads

OP SetNumLayers
    ŒîSTATE ModelConfigState
    new_num_layers?: NumLayers
    
    PRE MIN_NUM_LAYERS ‚â§ new_num_layers? ‚â§ MAX_NUM_LAYERS
    POST num_hidden_layers' = new_num_layers?

OP EnableMoE
    ŒîSTATE ModelConfigState
    num_experts?: ‚Ñï‚ÇÅ
    experts_per_tok?: ‚Ñï‚ÇÅ
    
    PRE num_experts? > 0 ‚àß 
        experts_per_tok? > 0 ‚àß 
        experts_per_tok? ‚â§ num_experts?
    POST ffn'.is_moe = true ‚àß
         ffn'.num_experts = num_experts? ‚àß
         ffn'.num_experts_per_tok = experts_per_tok?

OP SetCognitiveStreamLayers
    ŒîSTATE ModelConfigState
    interleave_layers?: seq ‚Ñï‚ÇÅ
    
    PRE ‚àÄ l ‚àà ran interleave_layers? ‚Ä¢ l ‚â§ num_hidden_layers
    POST cognitive'.stream_interleave_layers = interleave_layers?

END ModelConfig
